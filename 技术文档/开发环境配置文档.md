# 团队知识库管理工具 - 开发环境配置文档 (macOS 11.7.10)

## 1. 概述

本文档专门针对 macOS 11.7.10 系统，详细介绍团队知识库管理工具的开发环境搭建、配置和使用方法。

### 1.1 开发环境信息
- **目标系统**: macOS 11.7.10 (Big Sur)
- **开发模式**: 单机开发环境
- **架构**: M1/Intel 兼容

### 1.2 技术栈
- **前端**: React 18 + TypeScript + Vite + Ant Design
- **后端**: Node.js + Express + TypeScript + SQLite
- **开发工具**: ESLint + Prettier + Husky + lint-staged

### 1.3 开发环境架构
```
┌─────────────────────────────────────────────────────┐
│              macOS 11.7.10 开发环境                 │
│                                                     │
│  ┌─────────────┐    ┌─────────────┐               │
│  │    前端      │    │    后端      │               │
│  │  Vite Dev   │    │   Node.js   │               │
│  │ localhost:  │────│ localhost:  │               │
│  │    3000     │    │    8000     │               │
│  └─────────────┘    └─────────────┘               │
│                            │                        │
│                     ┌─────────────┐               │
│                     │   SQLite    │               │
│                     │  本地数据库  │               │
│                     └─────────────┘               │
│                                                     │
│  ┌─────────────────────────────────────────────────┐ │
│  │              本地文件存储                        │ │
│  │    ~/Documents/testClass/uploads               │ │
│  └─────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

## 2. macOS 系统要求和准备

### 2.1 系统信息确认
```bash
# 检查系统版本
sw_vers

# 输出示例:
# ProductName:    Mac OS X
# ProductVersion: 11.7.10
# BuildVersion:   20G1427

# 检查处理器架构
uname -m
# Intel: x86_64
# Apple Silicon: arm64
```

### 2.2 必需软件版本
- **Node.js**: 16.14.0+ (推荐 18.x LTS)
- **npm**: 8.0.0+ (Node.js 自带)
- **Git**: 2.30.0+ (Xcode Command Line Tools 自带)

### 2.3 系统资源要求
- **内存**: 最低 8GB (推荐 16GB)
- **磁盘空间**: 最低 10GB 可用空间
- **网络**: 需要互联网连接下载依赖包

## 3. macOS 开发工具安装

### 3.1 Xcode Command Line Tools 安装
首先安装 Xcode Command Line Tools，这是 macOS 开发的基础：

```bash
# 安装 Xcode Command Line Tools
xcode-select --install

# 验证安装
xcode-select -p
# 输出: /Library/Developer/CommandLineTools

# 检查 Git 版本
git --version
# 输出: git version 2.32.0 (Apple Git-132) 或更高版本
```

### 3.2 Homebrew 包管理器安装
Homebrew 是 macOS 上必备的包管理器：

```bash
# 安装 Homebrew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 验证安装
brew --version

# 更新 Homebrew
brew update

# 检查系统
brew doctor
```

### 3.3 Node.js 安装

#### 方法1: 使用 Homebrew (推荐)
```bash
# 安装最新 LTS 版本
brew install node

# 验证安装
node --version  # 应该显示 v16.14.0 或更高版本
npm --version   # 应该显示 8.0.0 或更高版本
```

#### 方法2: 使用 nvm (推荐用于多版本管理)
```bash
# 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash

# 重新加载 shell 配置
source ~/.zshrc
# 或
source ~/.bash_profile

# 安装最新 LTS 版本
nvm install --lts
nvm use --lts

# 验证安装
node --version
npm --version

# 设置默认版本
nvm alias default node
```

#### 方法3: 直接下载安装包
```bash
# 访问 https://nodejs.org/ 下载 macOS 安装包
# 下载 .pkg 文件并双击安装
# 适用于不想使用命令行的用户
```

### 3.4 Git 配置
```bash
# 配置用户信息
git config --global user.name "你的姓名"
git config --global user.email "你的邮箱@example.com"

# 配置默认编辑器
git config --global core.editor "code --wait"

# 配置行结束符 (macOS 推荐设置)
git config --global core.autocrlf input

# 验证配置
git config --list
```

### 3.5 VS Code 安装和配置

#### 安装 VS Code
```bash
# 方法1: 使用 Homebrew
brew install --cask visual-studio-code

# 方法2: 直接下载
# 访问 https://code.visualstudio.com/download
# 下载 macOS 版本并拖拽到 Applications 文件夹

# 验证安装
code --version
```

#### 配置命令行工具
```bash
# 打开 VS Code
open -a "Visual Studio Code"

# 在 VS Code 中按 Cmd+Shift+P，输入 "Shell Command: Install 'code' command in PATH"
# 或者手动创建软链接：
sudo ln -fs "/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code" /usr/local/bin/code
```

#### 必备扩展安装
```bash
# 安装必备扩展
code --install-extension ms-vscode.vscode-typescript-next
code --install-extension esbenp.prettier-vscode
code --install-extension dbaeumer.vscode-eslint
code --install-extension ms-vscode.vscode-json
code --install-extension formulahendry.auto-rename-tag
code --install-extension christian-kohler.path-intellisense
code --install-extension ms-vscode.vscode-npm-script
code --install-extension gruntfuggly.todo-tree
code --install-extension streetsidesoftware.code-spell-checker
```

#### macOS 专用配置
创建项目根目录 `.vscode/settings.json`：
```json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "files.exclude": {
    "**/node_modules": true,
    "**/dist": true,
    "**/.git": true,
    "**/.DS_Store": true
  },
  "search.exclude": {
    "**/node_modules": true,
    "**/dist": true,
    "**/.DS_Store": true
  },
  "terminal.integrated.defaultProfile.osx": "zsh",
  "terminal.integrated.env.osx": {
    "NODE_ENV": "development"
  }
}
```

### 3.6 其他推荐工具安装

#### 数据库工具
```bash
# DB Browser for SQLite
brew install --cask db-browser-for-sqlite
```

#### API 测试工具
```bash
# Postman
brew install --cask postman

# 或者 Insomnia
brew install --cask insomnia
```

#### 终端增强
```bash
# 安装 iTerm2 (可选，Terminal.app 也够用)
brew install --cask iterm2

# 安装 oh-my-zsh (可选)
sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
```

## 4. 项目初始化

### 4.1 项目目录设置
```bash
# 进入项目目录 (当前已在此目录)
cd ~/Documents/testClass

# 查看当前目录结构
ls -la

# 创建必要的子目录
mkdir -p frontend backend database uploads/{documents,thumbnails,avatars} logs scripts

# 创建基本文件
touch .gitignore .env README.md
```

### 4.2 环境配置文件

#### 根目录配置
创建根目录 `.env` 文件：
```bash
# 在项目根目录创建 .env 文件
cat > .env << 'EOF'
# 项目基本信息
PROJECT_NAME=knowledge-base-management
PROJECT_VERSION=1.0.0

# 开发环境配置
NODE_ENV=development
DEBUG=app:*

# macOS 本地路径配置
PROJECT_ROOT=/Users/weichen/Documents/testClass
UPLOAD_PATH=/Users/weichen/Documents/testClass/uploads
DB_PATH=/Users/weichen/Documents/testClass/database

# 前端开发服务器
FRONTEND_PORT=3000
FRONTEND_HOST=localhost

# 后端开发服务器
BACKEND_PORT=8000
BACKEND_HOST=localhost
EOF
```

#### 后端环境配置
```bash
# 创建后端环境配置
mkdir -p backend
cat > backend/.env.development << 'EOF'
# 服务器配置
PORT=8000
HOST=localhost
NODE_ENV=development

# macOS 本地路径配置
DB_PATH=/Users/weichen/Documents/testClass/database/knowledge_base_dev.db
UPLOAD_PATH=/Users/weichen/Documents/testClass/uploads
LOG_FILE=/Users/weichen/Documents/testClass/logs/app.log

# JWT 配置
JWT_SECRET=dev_jwt_secret_key_12345_macos
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# 文件上传配置
MAX_FILE_SIZE=104857600
ALLOWED_FILE_TYPES=pdf,doc,docx,xls,xlsx,ppt,pptx,txt,jpg,png,gif,svg

# CORS 配置
CORS_ORIGIN=http://localhost:3000
CORS_CREDENTIALS=true

# 日志配置
LOG_LEVEL=debug
LOG_MAX_SIZE=10m
LOG_MAX_FILES=5

# 开发工具配置
ENABLE_DOCS=true
ENABLE_PLAYGROUND=true
SWAGGER_PATH=/api-docs

# macOS 特定配置
PLATFORM=darwin
NODE_ENV=development
EOF
```

#### 前端环境配置
```bash
# 创建前端环境配置
mkdir -p frontend
cat > frontend/.env.development << 'EOF'
# API 配置
VITE_API_BASE_URL=http://localhost:8000/api/v1
VITE_API_TIMEOUT=30000

# 应用配置
VITE_APP_TITLE=团队知识库管理工具
VITE_APP_DESCRIPTION=团队文档知识管理平台
VITE_APP_VERSION=1.0.0

# 开发配置
VITE_DEV_PORT=3000
VITE_DEV_HOST=localhost
VITE_DEV_OPEN=true

# macOS 开发配置
VITE_PLATFORM=darwin
VITE_DEV_HTTPS=false

# 功能开关
VITE_ENABLE_MOCK=false
VITE_ENABLE_DEVTOOLS=true

# 文件上传配置
VITE_MAX_FILE_SIZE=104857600
VITE_ALLOWED_FILE_TYPES=pdf,doc,docx,xls,xlsx,ppt,pptx,txt,jpg,png,gif

# macOS 本地存储路径
VITE_UPLOAD_BASE_URL=http://localhost:8000/uploads
EOF
```

## 5. macOS 项目初始化

### 5.1 创建 .gitignore 文件
```bash
# 创建 macOS 和 Node.js 专用的 .gitignore
cat > .gitignore << 'EOF'
# macOS 系统文件
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*

# 环境变量
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# 日志文件
logs/
*.log

# 构建输出
dist/
build/
*.tgz
*.tar.gz

# 数据库文件
database/*.db
database/*.sqlite
database/*.sqlite3

# 上传文件
uploads/

# IDE 配置
.vscode/
.idea/

# 临时文件
temp/
tmp/
*.tmp
*.temp

# 备份文件
*.bak
*.backup
EOF
```

### 5.2 项目结构初始化
```bash
# 创建完整的项目结构
mkdir -p {frontend,backend}/{src,dist,public}
mkdir -p frontend/src/{components,pages,hooks,services,store,utils,types,styles}
mkdir -p backend/src/{controllers,services,models,dao,middleware,routes,utils,config}
mkdir -p database logs uploads/{documents,thumbnails,avatars}
mkdir -p scripts docs tests

# 创建基础配置文件
touch frontend/package.json backend/package.json
touch frontend/tsconfig.json backend/tsconfig.json
touch frontend/vite.config.ts backend/nodemon.json
```

### 5.3 初始化 npm 项目

#### 根目录 package.json
```bash
cat > package.json << 'EOF'
{
  "name": "knowledge-base-management",
  "version": "1.0.0",
  "description": "团队知识库管理工具",
  "scripts": {
    "dev": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "cd frontend && npm run dev",
    "build": "npm run build:backend && npm run build:frontend",
    "build:backend": "cd backend && npm run build",
    "build:frontend": "cd frontend && npm run build",
    "install:all": "npm install && cd backend && npm install && cd ../frontend && npm install",
    "clean": "rm -rf node_modules backend/node_modules frontend/node_modules",
    "lint": "npm run lint:backend && npm run lint:frontend",
    "lint:backend": "cd backend && npm run lint",
    "lint:frontend": "cd frontend && npm run lint"
  },
  "keywords": ["knowledge-base", "document-management", "team-collaboration"],
  "author": "Development Team",
  "license": "MIT",
  "devDependencies": {
    "concurrently": "^7.6.0",
    "husky": "^8.0.0",
    "lint-staged": "^13.0.0"
  },
  "engines": {
    "node": ">=16.14.0",
    "npm": ">=8.0.0"
  }
}
EOF
```

#### 安装根目录依赖
```bash
npm install
```

### 5.4 后端项目初始化

#### 创建后端 package.json
```bash
cd backend
cat > package.json << 'EOF'
{
  "name": "knowledge-base-backend",
  "version": "1.0.0",
  "description": "团队知识库管理工具后端服务",
  "main": "src/app.ts",
  "scripts": {
    "dev": "nodemon src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js",
    "lint": "eslint src/**/*.ts",
    "lint:fix": "eslint src/**/*.ts --fix",
    "format": "prettier --write src/**/*.ts",
    "test": "jest",
    "test:watch": "jest --watch"
  },
  "dependencies": {
    "express": "^4.18.2",
    "sqlite3": "^5.1.6",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "multer": "^1.4.5",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "helmet": "^7.0.0",
    "morgan": "^1.10.0"
  },
  "devDependencies": {
    "@types/node": "^20.5.0",
    "@types/express": "^4.17.17",
    "@types/cors": "^2.8.13",
    "@types/multer": "^1.4.7",
    "@types/bcryptjs": "^2.4.2",
    "@types/jsonwebtoken": "^9.0.2",
    "@types/morgan": "^1.9.4",
    "typescript": "^5.1.6",
    "ts-node": "^10.9.1",
    "nodemon": "^3.0.1",
    "eslint": "^8.47.0",
    "prettier": "^3.0.1",
    "@typescript-eslint/parser": "^6.4.0",
    "@typescript-eslint/eslint-plugin": "^6.4.0",
    "jest": "^29.6.2",
    "@types/jest": "^29.5.4"
  },
  "engines": {
    "node": ">=16.14.0"
  }
}
EOF

# 安装后端依赖
npm install
cd ..
```

#### 创建前端 package.json
```bash
cd frontend
cat > package.json << 'EOF'
{
  "name": "knowledge-base-frontend",
  "version": "1.0.0",
  "description": "团队知识库管理工具前端应用",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "format": "prettier --write src/**/*.{ts,tsx}",
    "test": "vitest",
    "test:ui": "vitest --ui"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.15.0",
    "antd": "^5.8.5",
    "axios": "^1.5.0",
    "@ant-design/icons": "^5.2.6"
  },
  "devDependencies": {
    "@types/react": "^18.2.20",
    "@types/react-dom": "^18.2.7",
    "@typescript-eslint/eslint-plugin": "^6.4.0",
    "@typescript-eslint/parser": "^6.4.0",
    "@vitejs/plugin-react": "^4.0.4",
    "eslint": "^8.47.0",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.3",
    "prettier": "^3.0.1",
    "typescript": "^5.1.6",
    "vite": "^4.4.9",
    "vitest": "^0.34.3"
  },
  "engines": {
    "node": ">=16.14.0"
  }
}
EOF

# 安装前端依赖
npm install
cd ..
```

### 5.5 TypeScript 配置

#### 后端 TypeScript 配置
```bash
cat > backend/tsconfig.json << 'EOF'
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "removeComments": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "moduleResolution": "node",
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.test.ts"
  ]
}
EOF
```

#### 前端 TypeScript 配置
```bash
cat > frontend/tsconfig.json << 'EOF'
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": "./",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": [
    "src"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ],
  "references": [
    {
      "path": "./tsconfig.node.json"
    }
  ]
}
EOF

cat > frontend/tsconfig.node.json << 'EOF'
{
  "compilerOptions": {
    "composite": true,
    "skipLibCheck": true,
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true
  },
  "include": [
    "vite.config.ts"
  ]
}
EOF
```

### 5.6 Vite 配置 (前端)
```bash
cat > frontend/vite.config.ts << 'EOF'
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 3000,
    host: 'localhost',
    open: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        secure: false,
      },
      '/uploads': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        secure: false,
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: true,
    minify: 'terser',
  }
})
EOF
```

### 5.7 Nodemon 配置 (后端)
```bash
cat > backend/nodemon.json << 'EOF'
{
  "watch": ["src"],
  "ext": "ts,json",
  "ignore": ["src/**/*.test.ts", "dist"],
  "exec": "ts-node src/app.ts",
  "env": {
    "NODE_ENV": "development"
  },
  "delay": 1000
}
EOF
```

## 6. 数据库和文件结构初始化

### 6.1 创建数据库初始化脚本
```bash
# 创建数据库初始化脚本
cat > scripts/init-db.js << 'EOF'
const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const fs = require('fs');

const dbPath = path.join(__dirname, '../database/knowledge_base_dev.db');
const dbDir = path.dirname(dbPath);

// 确保数据库目录存在
if (!fs.existsSync(dbDir)) {
  fs.mkdirSync(dbDir, { recursive: true });
}

// 创建数据库连接
const db = new sqlite3.Database(dbPath);

// 创建表的SQL语句
const createTables = `
-- 用户表
CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    avatar_path VARCHAR(255),
    is_active BOOLEAN DEFAULT 1,
    last_login_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 角色表
CREATE TABLE IF NOT EXISTS roles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    permissions TEXT,
    is_system BOOLEAN DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 文档表
CREATE TABLE IF NOT EXISTS documents (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    file_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INTEGER NOT NULL,
    mime_type VARCHAR(100),
    file_hash VARCHAR(64),
    thumbnail_path VARCHAR(255),
    download_count INTEGER DEFAULT 0,
    view_count INTEGER DEFAULT 0,
    is_public BOOLEAN DEFAULT 0,
    status VARCHAR(20) DEFAULT 'active',
    created_by INTEGER NOT NULL,
    updated_by INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- 标签表
CREATE TABLE IF NOT EXISTS tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(50) UNIQUE NOT NULL,
    color VARCHAR(7) DEFAULT '#1890ff',
    description TEXT,
    parent_id INTEGER,
    usage_count INTEGER DEFAULT 0,
    created_by INTEGER NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES tags(id),
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- 插入默认角色
INSERT OR IGNORE INTO roles (name, description, permissions, is_system) VALUES
('admin', '系统管理员', '["all"]', 1),
('editor', '编辑者', '["read", "write", "upload", "tag"]', 1),
('viewer', '查看者', '["read"]', 1);
`;

// 执行SQL
db.exec(createTables, (err) => {
  if (err) {
    console.error('❌ 数据库初始化失败:', err.message);
    process.exit(1);
  } else {
    console.log('✅ 数据库初始化成功');
    console.log('📍 数据库位置:', dbPath);
  }
  
  db.close((err) => {
    if (err) {
      console.error('❌ 关闭数据库连接失败:', err.message);
    }
  });
});
EOF

# 创建快速启动脚本
cat > scripts/start-dev.sh << 'EOF'
#!/bin/bash

echo "🚀 启动团队知识库管理工具开发环境..."

# 检查 Node.js
if ! command -v node &> /dev/null; then
    echo "❌ Node.js 未安装，请先安装 Node.js"
    exit 1
fi

# 检查数据库
if [ ! -f "database/knowledge_base_dev.db" ]; then
    echo "📦 初始化数据库..."
    node scripts/init-db.js
fi

# 检查依赖
if [ ! -d "node_modules" ]; then
    echo "📦 安装根目录依赖..."
    npm install
fi

if [ ! -d "backend/node_modules" ]; then
    echo "📦 安装后端依赖..."
    cd backend && npm install && cd ..
fi

if [ ! -d "frontend/node_modules" ]; then
    echo "📦 安装前端依赖..."
    cd frontend && npm install && cd ..
fi

# 启动开发服务器
echo "🎉 启动开发服务器..."
npm run dev
EOF

# 给启动脚本执行权限
chmod +x scripts/start-dev.sh
```

### 6.2 创建基础文件和目录
```bash
# 创建上传目录
mkdir -p uploads/{documents,thumbnails,avatars}

# 创建日志目录
mkdir -p logs

# 创建临时测试文件
echo "# 测试文档" > uploads/documents/test.md
echo "这是一个测试文档，用于验证文件上传功能。" >> uploads/documents/test.md

# 设置目录权限 (macOS)
chmod 755 uploads/
chmod 755 uploads/documents/
chmod 755 uploads/thumbnails/
chmod 755 uploads/avatars/
chmod 755 logs/
```
## 7. 开发环境启动和验证

### 7.1 一键启动开发环境
```bash
# 方法1: 使用启动脚本 (推荐)
./scripts/start-dev.sh

# 方法2: 手动启动
# 初始化数据库 (首次运行)
node scripts/init-db.js

# 安装所有依赖 (首次运行)
npm run install:all

# 启动开发服务器
npm run dev
```

### 7.2 分别启动前后端 (调试用)
```bash
# 终端1: 启动后端服务
cd backend
npm run dev

# 终端2: 启动前端服务  
cd frontend
npm run dev
```

### 7.3 验证开发环境
访问以下地址验证环境是否正常：

- **前端应用**: http://localhost:3000
- **后端API**: http://localhost:8000/api/v1
- **API文档**: http://localhost:8000/api-docs (如果启用)

### 7.4 macOS 特定的验证命令
```bash
# 检查端口占用
lsof -i :3000
lsof -i :8000

# 检查进程
ps aux | grep node

# 检查系统资源
top -pid $(pgrep -f "node")

# 查看开发日志
tail -f logs/app.log

# 检查数据库文件
ls -la database/
sqlite3 database/knowledge_base_dev.db ".tables"
```

## 8. macOS 开发调试技巧

### 8.1 使用 macOS 系统监控
```bash
# 监控文件变化
fswatch -o . | xargs -n1 -I{} echo "文件已更改"

# 监控内存使用
memory_pressure

# 监控网络连接
netstat -an | grep LISTEN
```

### 8.2 VS Code 调试配置 (macOS 优化)
创建 `.vscode/launch.json`：
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Backend (macOS)",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/backend/src/app.ts",
      "outFiles": ["${workspaceFolder}/backend/dist/**/*.js"],
      "runtimeArgs": ["-r", "ts-node/register"],
      "env": {
        "NODE_ENV": "development",
        "DB_PATH": "/Users/weichen/Documents/testClass/database/knowledge_base_dev.db"
      },
      "cwd": "${workspaceFolder}/backend",
      "console": "integratedTerminal",
      "sourceMaps": true,
      "envFile": "${workspaceFolder}/backend/.env.development"
    },
    {
      "name": "Debug Frontend (macOS)",
      "type": "node",
      "request": "launch",
      "cwd": "${workspaceFolder}/frontend",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["run", "dev"],
      "console": "integratedTerminal",
      "env": {
        "VITE_API_BASE_URL": "http://localhost:8000/api/v1"
      }
    }
  ]
}
```

### 8.3 终端配置优化
```bash
# 如果使用 zsh (macOS 默认)
echo 'export NODE_ENV=development' >> ~/.zshrc
echo 'export PATH="$PATH:/usr/local/bin"' >> ~/.zshrc
echo 'alias kb-dev="cd ~/Documents/testClass && ./scripts/start-dev.sh"' >> ~/.zshrc

# 重新加载配置
source ~/.zshrc
```

## 9. 常见问题和解决方案

### 9.1 macOS 权限问题
```bash
# 如果遇到权限错误
sudo xcode-select --reset
sudo xcode-select --install

# 修复 npm 权限问题
sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}

# 或者设置 npm 全局目录
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.zshrc
```

### 9.2 端口被占用
```bash
# 查看端口占用
sudo lsof -i :3000
sudo lsof -i :8000

# 杀死占用进程
kill -9 <PID>

# 或者使用不同端口
PORT=3001 npm run dev:frontend
PORT=8001 npm run dev:backend
```

### 9.3 Node.js 版本问题
```bash
# 如果使用 nvm 切换版本
nvm use 18
nvm alias default 18

# 验证版本
node --version
npm --version
```

### 9.4 SQLite 问题
```bash
# 检查 SQLite 是否可用
sqlite3 --version

# 如果没有安装 SQLite
brew install sqlite

# 重新编译 sqlite3 模块 (如果需要)
cd backend
npm rebuild sqlite3
```

### 9.5 macOS Monterey/Big Sur 特定问题
```bash
# 如果遇到 Python 构建错误
export PYTHON=$(which python3)
npm config set python $(which python3)

# 如果遇到 Node Sass 问题
npm rebuild node-sass

# 清理 npm 缓存
npm cache clean --force
```

## 10. 性能优化建议

### 10.1 macOS 系统优化
```bash
# 关闭不必要的系统服务
sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist

# 增加文件监控限制
echo kern.maxfiles=65536 | sudo tee -a /etc/sysctl.conf
echo kern.maxfilesperproc=65536 | sudo tee -a /etc/sysctl.conf

# 重启后生效，或临时设置
sudo sysctl -w kern.maxfiles=65536
sudo sysctl -w kern.maxfilesperproc=65536
```

### 10.2 开发工具优化
```bash
# VS Code 设置优化
echo '{
  "typescript.disableAutomaticTypeAcquisition": true,
  "search.exclude": {
    "**/node_modules": true,
    "**/.git": true,
    "**/dist": true,
    "**/.DS_Store": true
  },
  "files.watcherExclude": {
    "**/node_modules/**": true,
    "**/.git/**": true,
    "**/dist/**": true
  }
}' > .vscode/settings.json
```

## 11. 备份和恢复

### 11.1 开发环境备份
```bash
# 创建备份脚本
cat > scripts/backup-dev.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="$HOME/Documents/testClass-backup-$(date +%Y%m%d)"
mkdir -p "$BACKUP_DIR"

# 备份关键文件
cp -r . "$BACKUP_DIR/"

# 排除不必要的文件
rm -rf "$BACKUP_DIR/node_modules"
rm -rf "$BACKUP_DIR/backend/node_modules"
rm -rf "$BACKUP_DIR/frontend/node_modules"
rm -rf "$BACKUP_DIR/dist"
rm -rf "$BACKUP_DIR/logs"

echo "✅ 开发环境已备份到: $BACKUP_DIR"
EOF

chmod +x scripts/backup-dev.sh
```

### 11.2 快速恢复环境
```bash
# 创建恢复脚本
cat > scripts/restore-dev.sh << 'EOF'
#!/bin/bash
echo "🔄 恢复开发环境..."

# 清理现有环境
rm -rf node_modules backend/node_modules frontend/node_modules
rm -rf backend/dist frontend/dist

# 重新安装依赖
npm run install:all

# 重新初始化数据库
node scripts/init-db.js

echo "✅ 开发环境恢复完成"
EOF

chmod +x scripts/restore-dev.sh
```

## 12. 总结

经过以上配置，你的 macOS 11.7.10 开发环境已经完全准备就绪。主要包括：

### ✅ 已完成配置
1. **基础工具**: Xcode Command Line Tools, Homebrew, Node.js, Git
2. **开发环境**: VS Code + 扩展，终端配置
3. **项目结构**: 完整的前后端项目骨架
4. **配置文件**: 环境变量、TypeScript、ESLint、Prettier
5. **数据库**: SQLite 初始化脚本
6. **启动脚本**: 一键启动开发环境

### 🚀 快速开始命令
```bash
# 一键启动开发环境
./scripts/start-dev.sh

# 或者分步操作
node scripts/init-db.js
npm run install:all  
npm run dev
```

### 📁 项目目录结构
```
~/Documents/testClass/
├── frontend/          # React 前端
├── backend/           # Node.js 后端  
├── database/          # SQLite 数据库
├── uploads/           # 文件上传目录
├── scripts/           # 开发脚本
├── docs/             # 项目文档
└── logs/             # 日志文件
```

现在可以开始你的团队知识库管理工具开发之旅了！
```typescript
import { Database } from 'sqlite3';
import path from 'path';
import fs from 'fs';

const DB_PATH = path.join(__dirname, '../../database/knowledge_base_dev.db');

// 确保数据库目录存在
const dbDir = path.dirname(DB_PATH);
if (!fs.existsSync(dbDir)) {
  fs.mkdirSync(dbDir, { recursive: true });
}

const db = new Database(DB_PATH);

// 执行初始化 SQL
const initSql = fs.readFileSync(
  path.join(__dirname, '../sql/init.sql'),
  'utf8'
);

db.exec(initSql, (err) => {
  if (err) {
    console.error('Database initialization failed:', err);
  } else {
    console.log('Database initialized successfully');
  }
  db.close();
});
```

### 6.3 添加示例数据
创建 `backend/scripts/seed-data.ts`：
```typescript
// 示例数据插入脚本
import { Database } from 'sqlite3';
import bcrypt from 'bcryptjs';

const db = new Database('../database/knowledge_base_dev.db');

async function seedData() {
  // 创建默认管理员用户
  const hashedPassword = await bcrypt.hash('admin123', 10);
  
  db.run(`
    INSERT INTO users (username, email, password_hash, full_name, is_active)
    VALUES (?, ?, ?, ?, ?)
  `, ['admin', 'admin@example.com', hashedPassword, '系统管理员', 1]);

  // 插入示例标签
  db.run(`
    INSERT INTO tags (name, color, description, created_by)
    VALUES 
    ('技术文档', '#1890ff', '技术相关文档', 1),
    ('产品需求', '#52c41a', '产品需求文档', 1),
    ('会议纪要', '#faad14', '会议记录', 1)
  `);

  console.log('示例数据插入完成');
}

seedData();
```

## 7. 开发服务器启动

### 7.1 启动脚本配置

#### 根目录 package.json
```json
{
  "scripts": {
    "dev": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "cd frontend && npm run dev",
    "build": "npm run build:backend && npm run build:frontend",
    "build:backend": "cd backend && npm run build",
    "build:frontend": "cd frontend && npm run build",
    "lint": "npm run lint:backend && npm run lint:frontend",
    "lint:backend": "cd backend && npm run lint",
    "lint:frontend": "cd frontend && npm run lint",
    "test": "npm run test:backend && npm run test:frontend",
    "test:backend": "cd backend && npm test",
    "test:frontend": "cd frontend && npm test"
  },
  "devDependencies": {
    "concurrently": "^7.6.0",
    "husky": "^8.0.0",
    "lint-staged": "^13.0.0"
  }
}
```

#### 后端 package.json scripts
```json
{
  "scripts": {
    "dev": "nodemon --exec ts-node src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js",
    "lint": "eslint src/**/*.ts",
    "lint:fix": "eslint src/**/*.ts --fix",
    "format": "prettier --write src/**/*.ts",
    "test": "jest",
    "test:watch": "jest --watch",
    "db:init": "ts-node scripts/init-db.ts",
    "db:seed": "ts-node scripts/seed-data.ts",
    "db:reset": "npm run db:init && npm run db:seed"
  }
}
```

#### 前端 package.json scripts
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "format": "prettier --write src/**/*.{ts,tsx}",
    "test": "vitest",
    "test:ui": "vitest --ui"
  }
}
```

### 7.2 启动开发环境

#### 一键启动
```bash
# 安装所有依赖
npm run install:all

# 初始化数据库
npm run db:init

# 启动开发服务器
npm run dev
```

#### 分别启动
```bash
# 终端 1: 启动后端
cd backend
npm run dev

# 终端 2: 启动前端
cd frontend
npm run dev
```

### 7.3 验证环境
访问以下地址验证环境：
- 前端: http://localhost:3000
- 后端 API: http://localhost:8000/api/v1
- API 文档: http://localhost:8000/api-docs (如果启用)

## 8. 开发工作流

### 8.1 Git 工作流
```bash
# 1. 创建功能分支
git checkout -b feature/new-feature

# 2. 开发和提交
git add .
git commit -m "feat: add new feature"

# 3. 推送到远程
git push origin feature/new-feature

# 4. 创建 Pull Request

# 5. 合并后删除分支
git checkout main
git pull origin main
git branch -d feature/new-feature
```

### 8.2 提交规范
使用 Conventional Commits 规范：
```
feat: 新功能
fix: Bug 修复
docs: 文档更新
style: 代码格式修改
refactor: 代码重构
test: 测试相关
chore: 构建工具或辅助工具的变动
```

### 8.3 调试技巧

#### 后端调试
```typescript
// 使用 VS Code 调试器
// 或者使用 console.log
console.log('Debug info:', { variable });

// 使用 debug 模块
import debug from 'debug';
const log = debug('app:controller');
log('User created:', user);
```

#### 前端调试
```typescript
// React DevTools
// Chrome DevTools
// 或者使用 console
console.log('Component state:', state);

// 使用 debugger 断点
debugger;
```

## 9. 测试环境配置

### 9.1 后端测试配置
创建 `backend/jest.config.js`：
```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/src'],
  testMatch: ['**/__tests__/**/*.ts', '**/?(*.)+(spec|test).ts'],
  collectCoverageFrom: [
    'src/**/*.ts',
    '!src/**/*.d.ts',
  ],
};
```

### 9.2 前端测试配置
创建 `frontend/vitest.config.ts`：
```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
  },
});
```

## 10. 性能监控

### 10.1 开发环境性能监控
```bash
# 分析包大小
npm run build:analyze

# 性能测试
npm run perf:test
```

### 10.2 热重载配置
确保前后端都支持热重载：
- 前端: Vite 默认支持
- 后端: nodemon 配置

## 11. 常见问题解决

### 11.1 端口冲突
```bash
# 查看端口占用
netstat -ano | findstr :3000
lsof -ti:3000

# 杀死进程
kill -9 <PID>
```

### 11.2 依赖安装失败
```bash
# 清理 npm 缓存
npm cache clean --force

# 删除 node_modules 重新安装
rm -rf node_modules package-lock.json
npm install
```

### 11.3 TypeScript 编译错误
```bash
# 检查 TypeScript 配置
npx tsc --noEmit

# 重启 TypeScript 服务
# VS Code: Ctrl+Shift+P -> TypeScript: Restart TS Server
```

## 12. 开发规范

### 12.1 代码规范
- 使用 TypeScript 严格模式
- 遵循 ESLint 规则
- 统一使用 Prettier 格式化
- 编写有意义的注释

### 12.2 命名规范
- 文件名: kebab-case
- 变量名: camelCase
- 常量名: UPPER_SNAKE_CASE
- 组件名: PascalCase

### 12.3 目录规范
```
src/
├── components/    # 公共组件
├── pages/        # 页面组件
├── hooks/        # 自定义 Hooks
├── services/     # API 服务
├── utils/        # 工具函数
├── types/        # 类型定义
└── styles/       # 样式文件
```

## 13. 开发工具推荐

### 13.1 浏览器扩展
- React DevTools
- Redux DevTools
- Axe DevTools (无障碍测试)

### 13.2 VS Code 扩展
- Thunder Client (API 测试)
- GitLens (Git 增强)
- Bracket Pair Colorizer
- Auto Import - ES6, TS, JSX, TSX

### 13.3 辅助工具
- Postman (API 测试)
- Figma (设计稿查看)
- Notion (文档管理)

## 14. 更新和维护

### 14.1 依赖更新
```bash
# 检查过期依赖
npm outdated

# 更新依赖
npm update

# 检查安全漏洞
npm audit
npm audit fix
```

### 14.2 开发环境重置
```bash
# 完全重置开发环境
./scripts/reset-dev-env.sh
```

## 15. 支持和反馈

### 15.1 技术支持
- 项目文档: `/docs`
- 开发指南: 本文档
- API 文档: http://localhost:8000/api-docs

### 15.2 问题反馈
- GitHub Issues
- 开发团队邮件
- 技术交流群