# 团队知识库管理工具 - 系统设计文档

## 1. 系统概述

### 1.1 系统架构
采用三层架构模式：
- **前端层(WebApp)**: 负责用户界面展示和交互
- **服务层(WebService)**: 提供REST API接口，处理业务逻辑
- **数据层(SQLite)**: 数据持久化存储

### 1.2 技术栈选择
- **前端**: React + TypeScript + Ant Design
- **后端**: Node.js + Express + TypeScript
- **数据库**: SQLite
- **文件存储**: 本地文件系统

## 2. 系统架构设计

### 2.1 整体架构图
```
┌─────────────────────────────────────────┐
│              用户界面层                  │
├─────────────────────────────────────────┤
│    React前端应用 (端口: 3000)            │
│  - 用户管理  - 文档管理  - 搜索界面      │
│  - 标签管理  - 权限设置                  │
└─────────────────┬───────────────────────┘
                  │ HTTP/HTTPS
                  │ REST API
┌─────────────────▼───────────────────────┐
│              业务逻辑层                  │
├─────────────────────────────────────────┤
│    Express API服务 (端口: 8000)         │
│  - 认证授权  - 文档服务  - 搜索服务      │
│  - 用户服务  - 标签服务  - 权限服务      │
└─────────────────┬───────────────────────┘
                  │ SQL
                  │
┌─────────────────▼───────────────────────┐
│              数据存储层                  │
├─────────────────────────────────────────┤
│            SQLite数据库                 │
│  - 用户表    - 文档表    - 标签表        │
│  - 权限表    - 评论表                   │
└─────────────────────────────────────────┘
```

### 2.2 目录结构设计
```
project-root/
├── frontend/                 # 前端应用
│   ├── src/
│   │   ├── components/       # 组件
│   │   ├── pages/           # 页面
│   │   ├── services/        # API调用
│   │   ├── utils/           # 工具函数
│   │   └── types/           # TypeScript类型
│   ├── public/
│   └── package.json
├── backend/                  # 后端服务
│   ├── src/
│   │   ├── controllers/     # 控制器
│   │   ├── models/          # 数据模型
│   │   ├── routes/          # 路由
│   │   ├── middleware/      # 中间件
│   │   ├── services/        # 业务服务
│   │   └── utils/           # 工具函数
│   ├── uploads/             # 文件上传目录
│   └── package.json
├── database/                 # 数据库文件
│   └── knowledge_base.db
└── docs/                    # 项目文档
```

## 3. 核心模块设计

### 3.1 用户管理模块
**功能**: 用户注册、登录、权限管理
**组件**:
- UserController: 用户相关API接口
- UserService: 用户业务逻辑
- AuthMiddleware: 身份验证中间件

### 3.2 文档管理模块
**功能**: 文档上传、预览、编辑、删除
**组件**:
- DocumentController: 文档API接口
- DocumentService: 文档业务逻辑
- FileUploadService: 文件上传处理

### 3.3 搜索模块
**功能**: 全文搜索、标签搜索、高级筛选
**组件**:
- SearchController: 搜索API接口
- SearchService: 搜索算法实现
- IndexService: 搜索索引维护

### 3.4 标签管理模块
**功能**: 标签创建、分类、关联
**组件**:
- TagController: 标签API接口
- TagService: 标签业务逻辑

### 3.5 权限管理模块
**功能**: 用户角色、资源权限控制
**组件**:
- PermissionController: 权限API接口
- PermissionService: 权限验证逻辑
- RoleMiddleware: 角色验证中间件

## 4. 数据库设计概述

### 4.1 核心表结构
- **users**: 用户信息表
- **documents**: 文档信息表
- **tags**: 标签表
- **document_tags**: 文档标签关联表
- **permissions**: 权限表
- **user_roles**: 用户角色表
- **comments**: 评论表

### 4.2 关键关系
- 用户与文档: 一对多(创建者关系)
- 文档与标签: 多对多关系
- 用户与角色: 多对多关系
- 文档与评论: 一对多关系

## 5. 接口设计概述

### 5.1 API设计原则
- RESTful风格
- 统一的响应格式
- 适当的HTTP状态码
- 版本控制支持

### 5.2 核心API模块
```
/api/v1/
├── /auth          # 认证相关
├── /users         # 用户管理
├── /documents     # 文档管理
├── /tags          # 标签管理
├── /search        # 搜索功能
└── /permissions   # 权限管理
```

### 5.3 响应格式标准
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": "2024-01-01T00:00:00Z"
}
```

## 6. 安全设计

### 6.1 身份验证
- JWT token认证
- Token刷新机制
- 登录状态保持

### 6.2 权限控制
- RBAC权限模型
- 资源级权限控制
- API接口权限验证

### 6.3 数据安全
- 密码加密存储(bcrypt)
- SQL注入防护
- XSS攻击防护
- 文件上传安全验证

## 7. 性能设计

### 7.1 前端性能优化
- 组件懒加载
- 图片压缩和懒加载
- 静态资源CDN
- 代码分割

### 7.2 后端性能优化
- 数据库查询优化
- 缓存机制(内存缓存)
- 文件上传流式处理
- API响应压缩

### 7.3 数据库性能
- 合理的索引设计
- 查询语句优化
- 连接池管理

## 8. 部署设计

### 8.1 开发环境
- 前端: npm run dev (端口3000)
- 后端: npm run dev (端口8000)
- 数据库: SQLite文件

### 8.2 生产环境
- 前端: 静态文件部署
- 后端: PM2进程管理
- 数据库: SQLite文件备份

### 8.3 配置管理
- 环境变量配置
- 配置文件分离
- 敏感信息加密

## 9. 监控与日志

### 9.1 日志设计
- 访问日志记录
- 错误日志捕获
- 业务日志追踪
- 日志分级管理

### 9.2 监控指标
- API响应时间
- 系统资源使用率
- 用户活跃度
- 错误率统计

## 10. 扩展性设计

### 10.1 水平扩展
- 微服务架构预留
- 数据库分库分表准备
- 负载均衡支持

### 10.2 功能扩展
- 插件机制设计
- 第三方集成接口
- 移动端API支持